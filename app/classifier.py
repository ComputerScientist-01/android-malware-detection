import pickle
from androguard.core.bytecodes.apk import APK

permissions = []
with open('./static/permissions.txt','r') as f:
  content = f.readlines()
  for line in content:
    cur_perm = line[:-1]
    permissions.append(cur_perm)

def classify(file, ch):
    vector = {}
    app = APK(file)
    perm = app.get_permissions()
    for p in permissions:
        if p in perm:
            vector[p]=1
        else:
            vector[p]=0
        input = [ v for v in vector.values() ]
    if ch==0:
        ANN = pickle.load(open('static/models/ANN.pkl','rb'))
        result = ANN.predict([[input]])
        print(result)
        if result< 0.02:
            return 'Benign(safe)'
        else:
             return 'Malware'
    if ch==1:
        SVC = pickle.load(open('static/models/SVC.pkl','rb'))
        result = SVC.predict([input])
        if result=='benign':
            return 'Benign(safe)'
        else:
             return 'Malware'
